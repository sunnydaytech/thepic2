<link rel="import" href="/polymer/polymer.html">
<link rel="import" href="/iron-ajax/iron-ajax.html">
<link rel="import" href="/components/hot-card.html">

<dom-module id="page-hot">
  <style>
    :host {
      display: block;
    }
    ::-webkit-scrollbar { 
      display: none; 
    }
    .hot-card-el {
      display: inline-block;
      height: 500px;
      width: 400px;
    }
    #picsContainer {
      overflow: auto;
      white-space:nowrap;
      width: 100%;
    }
  </style>
  <template>
    <iron-ajax
      id="loader"      
      url="/_/hot"
      params='{}'
      handle-as="json"
      on-response="handleHotResponse"
      debounce-duration="300"></iron-ajax>
    <div id="picsContainer">
    </div>
  </template>
  <script>
    Polymer({
      is: 'page-hot',
      initialized: false,
      ready: function() {
        if (!this.initialized) {
          this.$.loader.generateRequest(); 
        }
        this.initialized = true;
      },
      handleHotResponse: function(event) {
        var context = this;
        event.detail.response.forEach(function(resp) {
          var hotCardEl = document.createElement('hot-card');
          hotCardEl.hot = resp;
          var cardWidth = 320;
          if (window.innerWidth <= 320) {
            cardWidth = window.innerWidth - 20;
          }
          hotCardEl.style.width = cardWidth + "px";
          context.$.picsContainer.appendChild(hotCardEl);
        });
        this.initialized = true;
      }
    });
  </script>
</dom-module>
